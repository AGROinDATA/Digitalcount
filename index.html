<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Count</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(green, gray);
            color: white;
            text-align: center;
        }
        h1 {
            color: white;
            margin: 20px 0;
        }
        .container {
            width: 90%;
            max-width: 1000px;
            margin: 0 auto;
        }
        .logo {
            width: 150px;
            margin: 20px auto;
        }
        .description {
            font-size: 1.2em;
            margin: 20px 0;
        }
        .input-box {
            margin: 20px 0;
        }
        input[type="file"], input[type="text"] {
            display: block;
            margin: 10px auto;
            padding: 10px;
            font-size: 1em;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            margin: 10px;
            cursor: pointer;
        }
        #object1Btn {
            background-color: yellow;
            color: black;
        }
        #object2Btn {
            background-color: blue;
            color: white;
        }
        #undoBtn, #clearBtn, #downloadBtn {
            background-color: gray;
            color: white;
        }
        #refreshBtn {
            background-color: red;
            color: white;
        }
        .canvas-container {
            position: relative;
            display: inline-block;
            margin-top: 20px;
        }
        #uploadedImage {
            max-width: 100%;
            height: auto;
        }
        #agroLogo {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
        }
        canvas {
            border: 2px solid white;
        }
        .count-table {
            margin: 20px auto;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
        }
        table {
            width: 100%;
            color: white;
            border-collapse: collapse;
        }
        td, th {
            padding: 10px;
            border-bottom: 1px solid white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Digital Count</h1>
        <a href="https://agroindata.com" target="_blank">
            <img src="https://agroindata.com/images/logo.jpg" alt="AGROinDATA Logo" class="logo">
        </a>
        <p class="description">1.- Instructions</p>
	<p class="description">1.- Select an image</p>
        <p class="description">2.- Choose Yellow/Blue button to count</p>
        <p class="description">3.- Download the data with CSV file or just make a Screenshot :)</p>
        <p class="description">This is an online tool to count objects, leave records, and make data available to whoever needs it, courtesy of AGROinDATA. For any demo or other requests, please contact us at agroindata@gmail.com</p>
        <p class="description">more info: AGROinDATA.com</p>

        <div class="input-box">
            <input type="text" placeholder="Write a title here" id="titleInput">
            <input type="file" accept="image/*" id="imageUpload" onchange="loadImage(event)">
        </div>

        <div class="canvas-container">
            <canvas id="canvas" width="200" height="100"></canvas>
            <img src="https://agroindata.com/images/logo.jpg" alt="AGROinDATA Logo" id="agroLogo">
        </div>

        <div>
            <button id="object1Btn" onclick="selectObject(1)">Object 1</button>
            <button id="object2Btn" onclick="selectObject(2)">Object 2</button>
            <button id="undoBtn" onclick="undoAction()">Undo</button>
            <button id="clearBtn" onclick="clearCanvas()">ðŸ”„ Refresh</button>
        </div>

        <div class="count-table">
            <table>
                <thead>
                    <tr>
                        <th>Object</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody id="countTableBody">
                    <tr>
                        <td>Object 1</td>
                        <td id="object1Count">0</td>
                    </tr>
                    <tr>
                        <td>Object 2</td>
                        <td id="object2Count">0</td>
                    </tr>
                </tbody>
            </table>
            <button id="downloadBtn" onclick="downloadCSV()">Download CSV</button>
        </div>

        <p>Created by Christian Stange Marcus, AGROinDATA with AI. More information: <a href="mailto:agroindata@gmail.com">agroindata@gmail.com</a></p>
    </div>

    <script>
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let selectedObject = null;
        let actions = [];
        let counts = { object1: 0, object2: 0 };
        let uploadedImage = null;

        function loadImage(event) {
            let reader = new FileReader();
            reader.onload = function() {
                uploadedImage = new Image();
                uploadedImage.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    canvas.width = uploadedImage.width;
                    canvas.height = uploadedImage.height;
                    ctx.drawImage(uploadedImage, 0, 0);
                    drawLogo();
                }
                uploadedImage.src = reader.result;
            }
            reader.readAsDataURL(event.target.files[0]);
        }

        function drawLogo() {
            let logo = document.getElementById('agroLogo');
            ctx.drawImage(logo, canvas.width - 60, canvas.height - 60, 50, 50);
        }

        function selectObject(objectType) {
            selectedObject = objectType;
        }

        function canvasClick(event) {
            if (selectedObject === null) return;
            let rect = canvas.getBoundingClientRect();
            let x = event.clientX - rect.left;
            let y = event.clientY - rect.top;

            let color = selectedObject === 1 ? 'yellow' : 'blue';
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, 2 * Math.PI);
            ctx.fillStyle = color;
            ctx.fill();

            actions.push({ objectType: selectedObject, x: x, y: y });
            counts[`object${selectedObject}`]++;
            updateCountTable();
        }

        function undoAction() {
            if (actions.length === 0) return;
            actions.pop();
            redrawCanvas();
        }

        function clearCanvas() {
            actions = [];
            counts = { object1: 0, object2: 0 };
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (uploadedImage) {
                ctx.drawImage(uploadedImage, 0, 0);
                drawLogo();
            }
            updateCountTable();
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (uploadedImage) {
                ctx.drawImage(uploadedImage, 0, 0);
            }
            drawLogo();
            actions.forEach(action => {
                ctx.beginPath();
                ctx.arc(action.x, action.y, 10, 0, 2 * Math.PI);
                ctx.fillStyle = action.objectType === 1 ? 'yellow' : 'blue';
                ctx.fill();
            });
            updateCountTable();
        }

        function updateCountTable() {
            document.getElementById('object1Count').textContent = counts.object1;
            document.getElementById('object2Count').textContent = counts.object2;
        }

        function downloadCSV() {
            let csvContent = 'Object,Count\n';
            csvContent += `Object 1,${counts.object1}\n`;
            csvContent += `Object 2,${counts.object2}\n`;

            let blob = new Blob([csvContent], { type: 'text/csv' });
            let link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'object_counts.csv';
            link.click();
        }

        
        canvas.addEventListener('click', canvasClick);
    </script>
</body>
</html>
